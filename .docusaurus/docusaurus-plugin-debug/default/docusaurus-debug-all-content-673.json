{
  "docusaurus-plugin-content-blog": {
    "default": {
      "blogSidebarTitle": "Recent posts",
      "blogPosts": [
        {
          "id": "/2024/02/13/2023-retrospect",
          "metadata": {
            "permalink": "/blog/2024/02/13/2023-retrospect",
            "source": "@site/blog/2024-02-13-2023-retrospect.md",
            "title": "2023 회고",
            "description": "벌써 2월이지만 2023년 회고를 써본다.",
            "date": "2024-02-13T00:00:00.000Z",
            "formattedDate": "February 13, 2024",
            "tags": [
              {
                "label": "retrospect",
                "permalink": "/blog/tags/retrospect"
              }
            ],
            "readingTime": 14.115,
            "hasTruncateMarker": true,
            "authors": [
              {
                "name": "yuseonLim",
                "title": "BackEnd Engineer",
                "url": "https://github.com/devyuseon",
                "imageURL": "https://avatars.githubusercontent.com/u/67352902?v=4",
                "key": "yuseonLim"
              }
            ],
            "frontMatter": {
              "title": "2023 회고",
              "description": "벌써 2월이지만 2023년 회고를 써본다.",
              "authors": "yuseonLim",
              "tags": [
                "retrospect"
              ],
              "hide_table_of_contents": false,
              "toc_max_heading_level": 4
            },
            "unlisted": false,
            "nextItem": {
              "title": "[TroubleShooting] express가 응답을 보내지 않았다. 왜..?",
              "permalink": "/blog/2024/02/04/troubleshooting-express-no-response"
            }
          },
          "content": "요즘 회사 업무 외에도 개인 공부를 점점 늘려가고 있다. 프로젝트도 새로 시작 하고, 스터디도 참여하며\n바쁜 시간을 보내고 있다. 블로그도 흔한 기술지식 복제 블로그 보다 나만의 생각을 공유하는 공간으로 만들고 싶어\n새로 개설했다. 훗날 내가 바라던 모습이 되어 이때의 나를 다시 복기하기 위해서 2023~2024초 회고를 남긴다.\n\n<!-- truncate -->\n\n## 취업\n\n2023년 상반기, 이제 막 상반기 서류 발표가 될 쯔음에 운좋게 안랩에 합격해 재직중이다.\n\n바랐던 꿈의 회사는 아니지만, 꿈의 장소였던 판교에 어찌저찌 입성하게 되었다. 첫 3달은 OJT 과정을 하면서\n업무에 필요한 지식을 익히는 시간을 가졌다.\n\n### 처음 배운 것들 ..\n\n#### Angular.js\n\n백엔드 개발자여도 프론트 개발은 할 줄 알아야 한다는 생각에, 호기롭게 풀스택 포지션에 지원했다.\nReact나 Vue같은 기술을 배울 줄 알았지만.. Angular.js와 친해져야 했다.\n모든 레퍼런스(스택오버플로우, 심지어는 공식문서, 블로그 등등...)가 2015-2016에 멈춰있었다.\n프론트 개발도 처음이였어서 공부 방법 자체를 잘 몰랐다. 그리고 ~~이미 없어진거나 다름없는~~\nAngular.js와 그다지 친해지고 싶지 않았다. 깊게 알아서 Angular.js 마스터가 되어도\n앞으로 써먹을 일이 크게 없다고 생각했다. 하지만 당장 업무를 해내야 하기 때문에 A to Z로 공부하는 방법이 아니라,\n회사 소스코드를 먼저 보고 거기에 쓰인 기술과 문법을 찾아보는 방식을 선택했다.\n콘솔로그를 이곳 저곳 찍어보며 이 버튼은 어떻게 동작하는지, 이 부분은 언제 렌더링 되는지,\n이걸 눌렀을때 데이터가 어떻게 바뀌는지 하나하나 찾아보았다. 양이 꽤 많았지만, 감사하게도 OJT라는 시간을 주셔서\n코드 전반적으로 거의 한번은 다 보고 업무를 시작할 수 있게 되었다. 그렇게 몇개월동안 프론트 운영 업무도 완벽히 수행해냈다.\n원하던 커리어 방향은 아니지만, 어쨌든 주어진 것을 해낼 수 있는 사람은 된 것 같다.\n\n그리고 지금은 React로 전환 예정에 있어서, 회사에서 React를 공부중이다. 그동안 아무 생각 없이 양방향 데이터 바인딩 방식인\nAngular.js만 써오다가 단방향 방식인 React로 뭘 만들려니 쉽지는 않다.\n\n하지만 하면 할수록 백엔드를 더 열심히 하고 싶다는 생각이 든다... 어쩔 수 없다보다.\n\n#### Node.js, Express\n\nJava와 Spring만 공부해왔던 터라, Node.js와 Express 기반으로\n개발 하는 것은 나름의 도전이였다. Javascript와도 매우 .. 친하지 않아 많이 낯설었다.\npromise라던가, 비동기 라던가,, 이런 개념들을 새로 배울 수 있었다.\nSpring 진영에선 비동기 처리를 위해서 Spring WebFlux나 @Async로 처리를 해줘야 하는 것으로 아는데,\nNode.js 환경에선 그런 추가적인 장치 없이 비동기 프로그래밍이 가능한 것이 매력적인 것 같다.\n아직 모든 것을 다 이해하지는 못했지만 궁금한것을 찾아보며 하나씩 이해중이다.\n싱글스레드 방식이지만 요청이 Blocking I/O(네트워크, 파일)일 경우 별도의 스레드에서 처리하게 된다.\n어떤 서비스이냐에 따라 노드를 채택하는것이 더 좋을 수 있을 것 같다.\n그동안 Spring이 최고! 인줄 알았는데, 노드를 새로 공부하면서 둘의 장단점에 대해 조금은 알게 되었다.\n라고 말하면서.. 개인적으로는 Spring을 공부하고 있다. 아무래도 시장은 아직 Spring 진영인 것 같기 때문이다. 그렇지만 필요할때 언제든 node나 파이썬을 도입해서 써볼 열린 마음은 준비되어 있다. :)\n\n#### Docker\n\n도커도 입사후에 처음 공부했다. 도커는 정의와 개념부터 찬찬히 공부했다. 도커 공부는 공식문서를 가장 많이 참고했다.\n공부 후에는 Docker와 Container란?, Dockerfile, Docker Compose, 이미지 최적화, Volume, 네트워크 등의 주제로 나누어 6개정도 글을 작성했고 이를 발표하는 시간을 가졌다.\n추가적으로 더 다듬어 블로그에도 업로드 했는데, 이 블로그로 시간이 생기면 옮겨올 생각이다.\n회사 프로젝트가 리눅스 기반이라 로컬 환경이 구축되어 있지 않았다. 파일 경로나 명령어 등이 리눅스 기준이여서 로컬에서 개발이 불가능했다. Docker Desktop이 유료화 되어 삭제해달라는 전사 메일을 받아\nWSL로 로컬 개발환경을 구축해 공유했다. RockyLinux 8버전을 쓰고 있는데, 이건 마이크로소프트가 제공해주지 않아 도커 컨테이너에서 추출해야 했다. 이 가이드 문서도 작성해 파트에 공유했다.\n\n아직 완벽히 이해하지 못했지만, Docker와 Docker Swarm, Ansible, Bamboo를 이용한 빌드/배포\n운영은 할 수 있게 되었다. 입사 할 당시엔 빌드 배포 부분이 가장 이해가 안되고 어려웠다. 그래도 흐름정도는 알게 된 것이 올해 가장 큰 수확인 듯 하다.\n\n### 그리고 ..\n\n내 생각과 회사의 방향, 그리고 성향(?)은 많이 달랐다. 여긴 좀 안정적인 느낌이고 내가 그리던 활발한, 서로 함께하고 공유하는 문화를 가진 그런 개발과는 거리가 좀 있는 듯 했다. 내가 맡은 프로젝트는 나 포함 개발자가 두명 뿐이라.. 좋은 시니어들이 많은 회사에 가고싶다는 생각을 했다. 물론 여기도 훌륭한 개발자들이 많다. 그러나 우리 팀은 총 15명인데, 그중 웹개발자는 나포함 두명이다. 회의를 할때나\n기술 공유 세션을 가질때 앉아있기 민망하다는 생각도 가끔 한다. 개발자는 폭넓게 알아야 하지만\n윈도우 개발, 리눅스 커널 개발?, 암호학(??정수론???) 까지는 내가 품을 수 없을 것 같다..\n아무튼 그런 분들이 서로 토론하면서 지식을 나누는 대화를 하는 것을 보면.. 나도 끼고싶다는 생각을 많이 한다. 환경적인것을 탓하는 것은 나쁜 것이지만 그래도 웹개발자가 많은 곳에서 일하면 내가 흡수할 수 있는 지식이 아무래도 많지 않을까? 좋은 코드든 나쁜 코드든 다양한 사람들의 코드도 보고 싶다. 그리고 내가 작성한 코드에 대해 다양한 사람들의 의견도 들어보고 싶다. 이제 다음주부턴 혼자 일하게 된다.. 휴직을 하게 되셔서 혼자가 되었다. 이제 운영업무도 더 늘어날 것 같다. 빨리 할거 다 해버리고 하고싶은거 하게 해달라고 해야지..\n\n회사에서 하는 일이 내가 하고싶은 기술스택과는 상이했고, 내가 바랐던 개발자의 삶이 맞나 싶어서 몇달은 좀 우울해 했었다. 지금은 다 극복하고 오히려 더 열심히 달리는 중이다. 우울해 할 시간이 어디있나.. 공부해야 한다..!! 요즘 개발자의 기준이 점점 상향되고 있는 것을 느낀다. 시간이 갈 수록 더 많이 알아야 되는 것 같다. 다행히도 공부는 즐겁다. 알아가는 즐거움이란 개발자에게 가장 큰 재능(?) 이 아닐까 싶은데, 다행히도 갖춘 듯 하다. 힘든데, 재밌다. 모르는게 많아서 늘 괴롭기도 하다..\n\n일을 하며 더욱 더 알게 된 것인데, 나는 아무래도 관종인 듯 하다. 사람들이 쓰는 것을 개발하는게 좋고,\n세상에 나와있어 이거 내가 개발했어요~ 하는 것이 좋다. 아무래도 사내 서비스다 보니 재미가 좀 떨어진다. 제품 개발을 하는 팀이였으면 좀 더 재밌었을지도 모른다. 집 좀 못가도 그런 개발을 해보고 싶다.\n언젠간 서비스 회사를 가고 싶다. 그게 나에게 더 보람을 가져다 줄 것 같다.\n\n## 졸업\n\n<div style={{textAlign: 'justify', width: '40%'}}>\n\n![](../static/img/post-img/202402140133.jpeg)\n\n</div>\n\n졸업을 했다. 코로나 학번이라 컴퓨터공학과 친구들을 많이 사귀지 못한 것이 아쉽다.. 자율공학부였던 터라, 1학년은 컴공이 아니였기 때문이다. 그럼에도 불구하고 좋은 친구들을 많이 사귀었다. 친구 없다고 생각했는데 이렇게 예쁜 꽃다발을 많이 받은걸 보면 그렇게 잘못 산건 아니였구나 생각이 든다 ㅋㅋ 졸업 유예를 한 상태에서 취업한 터라, 회사를 다니다가 졸업을 하게 되었다. 난 정말 취업하려면 1년 반은 걸릴 줄 알았다.\n\n## 자취\n\n본가는 성북구인지라, 판교는 좀 멀었다. 솔직히 다닐 수는 있었지만 핑계로 자취를 하겠다고 강력하게 주장했고, 정자역 주변에서 자취를 시작하게 되었다. 오래된 아파트이지만 19평이라 비좁거나 하지는 않다. 이번에 이사오면서 M7 스마트모니터도 샀는데, 아주 만족한다. 본가에서는 없었던 나만의 티비가 생겼다. 누워서 OTT 보는 행복이란.. 식탁도 사고 소파도 사고 커튼도 달고, 아주 만족하고 있다. 처음엔 너무 외로워서 힘들었는데 이젠 좀 적응되었다. 청소하는 즐거움도 알게 되었다ㅋㅋ 한번 화장실 청소 시작하면 집착적으로 1시간은 청소한다.\n\n# 끝내며\n\n다시 공부를 시작해 이것저것 열심히 하는 중이다. 회사에서 이룰 수 없다면 개인적으로 공부를 통해서 이것저것 쌓아 나가야 겠다는 생각이다. 물론 회사에서도 집중해서 일을 정확하고 빠르게 끝내고, 내가 개인적으로 하고 싶었던 것들을 하겠다고 도전해볼 생각이다. 회고는 처음 써보는데 이렇게 쓰는게 맞는 지는 모르겠다. 나중에 다시 읽어보려고 한번 써봤다. 그럼 .. 이상 끝."
        },
        {
          "id": "/2024/02/04/troubleshooting-express-no-response",
          "metadata": {
            "permalink": "/blog/2024/02/04/troubleshooting-express-no-response",
            "source": "@site/blog/2024-02-04-troubleshooting-express-no-response.md",
            "title": "[TroubleShooting] express가 응답을 보내지 않았다. 왜..?",
            "description": "에러가 발생하지 않았는데, 클라이언트는 서버의 응답을 받지 못했다. 이유를 찾아보자 !",
            "date": "2024-02-04T00:00:00.000Z",
            "formattedDate": "February 4, 2024",
            "tags": [
              {
                "label": "troubleshooting",
                "permalink": "/blog/tags/troubleshooting"
              },
              {
                "label": "express",
                "permalink": "/blog/tags/express"
              },
              {
                "label": "nginx",
                "permalink": "/blog/tags/nginx"
              }
            ],
            "readingTime": 6.91,
            "hasTruncateMarker": true,
            "authors": [
              {
                "name": "yuseonLim",
                "title": "BackEnd Engineer",
                "url": "https://github.com/devyuseon",
                "imageURL": "https://avatars.githubusercontent.com/u/67352902?v=4",
                "key": "yuseonLim"
              }
            ],
            "frontMatter": {
              "title": "[TroubleShooting] express가 응답을 보내지 않았다. 왜..?",
              "description": "에러가 발생하지 않았는데, 클라이언트는 서버의 응답을 받지 못했다. 이유를 찾아보자 !",
              "authors": "yuseonLim",
              "tags": [
                "troubleshooting",
                "express",
                "nginx"
              ],
              "hide_table_of_contents": false
            },
            "unlisted": false,
            "prevItem": {
              "title": "2023 회고",
              "permalink": "/blog/2024/02/13/2023-retrospect"
            },
            "nextItem": {
              "title": "오픈소스 첫 기여 ✨",
              "permalink": "/blog/2024/01/29/first-opensearch-contribute-docker-compose"
            }
          },
          "content": "## 문제 상황\n\n문제 상황이 무엇인지 설명하기 전에, 우리 서비스는 파일을 `등록` 하는 기능이 있고, 똑같은 파일을 중복으로 등록할 수 없다. 중복 등록을 시도할 경우엔 메세지가 뜨며 등록이 안된다.\n\n그런데 사용자로부터 이런 연락을 받았다.\n\n> 파일을 업로드 하고, `등록` 버튼을 눌렀는데 **등록에 실패** 했다는 메시지가 떴습니다.<br/>\n> 그래서 다시 등록을 시도했는데, **중복 등록** 이라고 하며 등록이 되지 않았습니다. <br/>\n> 확인해보니 처음에 등록한 리포트가 잘 등록이 되어 있네요?\n\n그러니까, 실패했다는 메세지가 떴는데 실제론 성공했다는 거다.\n\n<!-- truncate -->\n\n## 증상 파악\n\n![](../static/img/post-img/diagram1.png)\n\n등록 기능 프로세스는 이렇다. express에서 요청을 전달하고, spring에서 등록 과정을 수행하고, 그것을 다시 express에 넘기고, express는 클라이언트에 완료를 전달한다.\n\n로그를 살펴보니, **express가 client로 등록 완료 전달** 하는 부분 외에는 모두 success, 200으로 에러 없이 잘 수행되었다.\n\n![](../static/img/post-img/diagram2.png)\n\n**express가 client로 등록 완료 전달** 하는 부분은 ? 로 남았다. 이런 로그를 발견했기 때문이다.\n\n```\n[시간] \"POST /api/*** HTTP/1.1\" - - \"출처\" \"클라이언트 정보\" - - ms\n```\n\n이 로그는 express의 [morgan](https://expressjs.com/en/resources/middleware/morgan.html) 미들웨어가 남긴 로그이다. 원래라면 아래처럼 응답시간, 응답크기, 걸린시간이 표시 되어야 한다.\n\n```\n[시간] \"POST /api/*** HTTP/1.1\" 200 49 \"출처\" \"클라이언트 정보\" - 317.922 ms\n```\n\n뭔가 응답이 정상적으로 처리되지 않은 듯 했다.\n\n그러나 미스테리인 점은 .. express가 `await` 으로 spring의 응답을 기다리고, 그 뒤에 성공했을땐 로그를 남기게 되어 있는데, 그 로그는 남았다는 것이다.\n\nexpress에 에러는 없었고, spring에도 에러는 없었는데, 클라이언트에 응답 전송만 정상적으로 되지 않았다.\n\n찾아보니, 위 -- 로 처리된 로그는 express가 응답 자체를 하지 않았을 때 일어나는 일이라고 한다.\n\n> https://stackoverflow.com/questions/39728057/no-request-status-in-node-js-morgan-logging > https://github.com/expressjs/morgan/issues/121\n\n위 링크에서 추정한 원인은 다음과 같다.\n\n:::tip[아마도..]\n\nresponse를 보내기 전에 TCP 연결이 끊어진 듯!\n\n:::\n\n로그 시간을 파악해보니 클라이언트 요청 ~ spring의 응답 까지는 1분 5초 내외로 소요되었다.\n\n그렇다면 어디서 TCP 연결을 해제했을까?\n\n## 원인 파악\n\n내가 의심한 것들은 다음과 같다.\n\n- axios timeout\n- node.js timeout\n- OS의 TCP timeout\n- L4 스위치 timeout\n- Nginx timeout\n\n### axios timeout\n\n따로 설정한 것이 없다. [default는 no timeout](https://github.com/axios/axios/blob/main/README.md#request-config) 이다.\n\n### node.js timeout\n\n노드13 버전 이후로는 no timeout이다.\n\n노드8 버전을 쓰는 우리 프로젝트는 120s가 기본으로 설정 되어 있다. (처음알았다 ..)\n\n> https://nodejs.org/api/http.html#servertimeout\n\n그러나 2분 보다 오래 걸리진 않았으므로 이것도 아니다.\n\n### OS의 TCP timeout\n\n```\ncat /proc/sys/net/ipv4/tcp_keepalive_time\n```\n\n- tcp_keepalive : tcp 연결이 되고 나서 얼마나 그 연결을 지속하는지\n\n7200(2시간) 으로 널널했다.\n\n### L4 스위치\n\nL4 에서도 뭔가 타임아웃이 걸려있는것은 아닐까..? 하고 해당 사항을 인프라팀에 문의했는데\n\n아니다. (~의심해서 죄송합니다...~)\n\n전에도 L4 설정 문제때문에 안된 기능이 있어서, 생각났었는데 .. 어쨌든 이게 문제는 아니였다.\n\n### Nginx timeout\n\n```nginx title=\"/etc/nginx/nginx.conf\"\nkeepalive_timeout 65; // default 75\n```\n\n여기였다 !!\n\nkeepalive_timeout이 65초로 설정 되어 있었다. 지금껏 Nginx 설정을 바꿀 일이 없어서 자세히 들여다 보지 않아서 몰랐다.\n\n이 사실을 알고 난 뒤 nginx 에러 로그를 보니 (로그 경로는 nginx.conf 에 있다.)\n\n```text title=\"error.log\"\n[error] upstream timed out (110: Connection timed out) while reading response header from upstream .. 생략\n```\n\nconnection timeout 에러 로그가 찍혔다.\n\nspring이 express로 응답을 보내, express가 client에 응답하기 전에 client와 express간의 연결이 끊어져 client가 응답을 받지 못한 것이다.\n\n## 해결\n\n해결 방법으로는 이런 것들이 있겠다.\n\n- timeout 늘리기\n- upstream인 spring 서버의 처리 성능 향상하기 (best)\n\n그리고 nginx 로그는 도커 컨테이너 안에 있어서, 컨테이너가 내려가면 로그 파일이 날아가 볼 수 없다.\n도커 컨테이너에서 쌓은 로그는 volume으로 연결해 host에도 쌓게 해놨다. nginx 로그도 표준 출력으로 내보내 (/dev/stdout 으로 심볼릭 링크 걸기) 도커가 로그를 수집하게 하거나 nginx 로그를 volume으로 설정해 보관 할 필요가 있다.\n\n일단 timeout을 늘려서 급한 불을 끄고, spring 서버의 처리 성능을 높일 방법을 생각 해 볼 것이다.\n\n적고보니 별일 아닌 듯 하지만,, 의미 있었던 과정이였다.\n\n이 이슈로 인해 우리 서비스의 어떤 부분에 timeout이 얼만큼 걸려있는지 확인 할 수 있었고, 로그도 좀 더 보충할 수 있었다. 다음에 이러한 일이 발생하면 이 경험으로 인해 원인 파악을 조금은 빨리 할 수 있을까 기대해보며 글을 마친다."
        },
        {
          "id": "/2024/01/29/first-opensearch-contribute-docker-compose",
          "metadata": {
            "permalink": "/blog/2024/01/29/first-opensearch-contribute-docker-compose",
            "source": "@site/blog/2024-01-29-first-opensearch-contribute-docker-compose.md",
            "title": "오픈소스 첫 기여 ✨",
            "description": "에러가 발생하지 않았는데, 클라이언트는 서버의 응답을 받지 못했다. 이유를 찾아보자 !",
            "date": "2024-01-29T00:00:00.000Z",
            "formattedDate": "January 29, 2024",
            "tags": [
              {
                "label": "docker",
                "permalink": "/blog/tags/docker"
              },
              {
                "label": "opensource-contributions",
                "permalink": "/blog/tags/opensource-contributions"
              }
            ],
            "readingTime": 1.925,
            "hasTruncateMarker": true,
            "authors": [
              {
                "name": "yuseonLim",
                "title": "BackEnd Engineer",
                "url": "https://github.com/devyuseon",
                "imageURL": "https://avatars.githubusercontent.com/u/67352902?v=4",
                "key": "yuseonLim"
              }
            ],
            "frontMatter": {
              "title": "오픈소스 첫 기여 ✨",
              "description": "에러가 발생하지 않았는데, 클라이언트는 서버의 응답을 받지 못했다. 이유를 찾아보자 !",
              "authors": "yuseonLim",
              "tags": [
                "docker",
                "opensource-contributions"
              ],
              "hide_table_of_contents": false
            },
            "unlisted": false,
            "prevItem": {
              "title": "[TroubleShooting] express가 응답을 보내지 않았다. 왜..?",
              "permalink": "/blog/2024/02/04/troubleshooting-express-no-response"
            },
            "nextItem": {
              "title": "[Java] 에러 메시지, Stacktrace가 생략되는 문제",
              "permalink": "/blog/2024/01/02/java-no-stacktrace"
            }
          },
          "content": "비록 공식문서의 오류를 고치는 일이였지만,\n\n처음으로 오픈소스에 기여했고 무려 Docker 문서 이다!!\n\n머지 되었을때는 정말 뿌듯했고 이슈를 생성하고 PR을 날리는 과정도 재밌었다.\n\n<!-- truncate -->\n\n## 문제 발견, 이슈 생성\n\n![](../static/img/post-img/20240205204509.png)\n\n문서에 틀린 부분을 발견하고, 이슈를 생성했다.\n\n수정이 필요한게 맞다면 내가 작업해도 되는지 물어봤다.\n\n![](../static/img/post-img/20240205204536.png)\n\nassgin 해주셨고, 문서 위치가 바뀌었으니 compose-spec 레포지토리에서 PR을 해달라는 친절한 가이드까지 주셨다.\n\n## Pull Request 생성하기\n\n먼저 compose-spec을 fork하고, 소스코드 수정 후 commit 했다.\n\n![](../static/img/post-img/20240205204610.png)\n\n다시 upstream으로 와서 pull request를 생성했다.\n\n![](../static/img/post-img/20240205204624.png)\n\n이건 내가 CONTRIBUTING.md를 꼼꼼히 보지 않아 생긴 일이다. ㅜㅜ\n\n그냥 커밋할때 계정 정보를 확인해달라는 말인 줄 알았는데,\n\n커밋 메세지에 sign-off를 포함하지 않으면 DCO check에 실패 하면서 오류가 난다.\n\n친절히 알려주셔서 커밋 메세지 수정 후 강제 푸시했고,\n\n이후 빌드에 한 번 실패해 한가지 수정을 더 하고 머지되었다.\n\n![](../static/img/post-img/20240205204639.png)\n\n![](../static/img/post-img/20240205204646.png)\n\n이렇게 오픈소스 기여에 작지만 위대한 첫 걸음을 내딛었다.\n\n앞으로도 문서 뿐만 아니라 코드 레벨까지 .. 더 많은 오픈소스에 기여할 수 있게 되면 좋겠다."
        },
        {
          "id": "/2024/01/02/java-no-stacktrace",
          "metadata": {
            "permalink": "/blog/2024/01/02/java-no-stacktrace",
            "source": "@site/blog/2024-01-02-java-no-stacktrace.md",
            "title": "[Java] 에러 메시지, Stacktrace가 생략되는 문제",
            "description": "NullPointerException의 에러 메시지가 빈 채로 출력된다",
            "date": "2024-01-02T00:00:00.000Z",
            "formattedDate": "January 2, 2024",
            "tags": [
              {
                "label": "java",
                "permalink": "/blog/tags/java"
              }
            ],
            "readingTime": 4.155,
            "hasTruncateMarker": true,
            "authors": [
              {
                "name": "yuseonLim",
                "title": "BackEnd Engineer",
                "url": "https://github.com/devyuseon",
                "imageURL": "https://avatars.githubusercontent.com/u/67352902?v=4",
                "key": "yuseonLim"
              }
            ],
            "frontMatter": {
              "title": "[Java] 에러 메시지, Stacktrace가 생략되는 문제",
              "description": "NullPointerException의 에러 메시지가 빈 채로 출력된다",
              "authors": "yuseonLim",
              "tags": [
                "java"
              ]
            },
            "unlisted": false,
            "prevItem": {
              "title": "오픈소스 첫 기여 ✨",
              "permalink": "/blog/2024/01/29/first-opensearch-contribute-docker-compose"
            }
          },
          "content": "## 문제 상황\n\n테스트 스크립트를 배포시에 실행하게 되어 있는데, 해당 스클립트는 같은 api를 여러 case로 몇십번 호출한다.\n\n최초 실행시에는 성공하고,\n\n두번째 이후부턴 실패한다.\n\n<!-- truncate -->\n\n지금까지는 서비스 실행시 한번만 실행했어서 발견을 못 한 문제였다.\n\n에러가 발생한 지점은 여기였다.\n\n```java\ncatch (Exception e) {\n    String msg = e.getMessage(); // errMsg: null\n    if (msg.equalsIgnoreCase(\"XXX\")) { // NullPointerException 발생!\n        //\n    }\n}\n```\n\ntry ~ catch 문에서 에러 메세지를 가져와 어떤 에러 메시지인지 판단하려고 할 때, `e.getMessage()` 결과가 **null** 이 되어 catch 구문에서 다시 에러가 발생하는 것이였다.\n\n로직을 살펴보니 특정 case엔 무조건 try쪽에서 NPE가 발생하고, catch문으로 들어오게 되어있었다.\n\n근데 왜 최초 실행시엔 msg가 null이 아닌가..???!!!\n\n해당 현상을 재현한 뒤에 최초 실행 / 이후 실행에 대한 에러를 출력해 보았다.\n\n**최초**\n\n```\nclass java.lang.NullPointerException: Cannot invoke \"Object.toString()\" because of \"java.util.Map.get(Object) is null\n// 굉장히 긴 StackTrace\n```\n\n**두번째~**\n\n```java\nclass java.lang.NullPointerException: null\n```\n\n나는 내가 로직 어딘가에 NPE가 발생하는 원인을 놓친줄 알고 며칠을 삽질했는데, 스택오버플로우에서 이 글을 발견했다.\n\n> https://stackoverflow.com/questions/2411487/nullpointerexception-in-java-with-no-stacktrace\n\n관련해서 간략하게 조사해 보았다.\n\n## JVM Stacktrace 생략\n\n[JDK5 릴리즈 노트](https://www.oracle.com/java/technologies/javase/release-notes-introduction.html)를 보면 Exception이 반복적으로 발생할 때, 컴파일러는 StackTrace를 출력하는것을 멈춘다고 한다.\n\n이것은 JVM의 JIT컴파일러의 C2컴파일러의 기본 최적화 옵션 이라고 한다.\n\n[OpenJDK의 소스 코드](https://github.com/openjdk/jdk/blob/master/src/hotspot/share/opto/graphKit.cpp#L528)를 보면 다음 다섯가지 Exception에 대해 최적화 옵션이 적용된다.\n\n:::info\n\n**Stacktrace 생략 최적화 옵션 적용되는 Exception**\n\n- NullPointerException\n- ArithmeticException\n- ArrayIndexOutOfBoundsException\n- ClassCastException\n- ArrayStoreException\n\n:::\n\n![](../static/img/post-img/20240205210954.png)\n\n최적화 옵션을 비활성화 하려면 아래 JVM 옵션을 추가해 주면 된다.\n\n```\n-XX:-OmitStackTraceInFastThrow\n```\n\n하지만 이는 성능 최적화를 위한 옵션으로, 해당 Exception이 반복적으로 일어나지 않게끔 처리 하는것이 올바른 방향 일 것이다.\n\nException 처리에 대한 최적화를 하는 이유가 궁금해서 찾아보았다.\n\nJava에서 Exception을 던지는 비용은 꽤 비싸다고 한다. Exception이 발생하면 해당 예외가 어디서 발생했는지 추적하며 정보를 수집하고 Stack Trace를 생성한다. 이를 계산하는데에도 시간이 꽤 걸린.\n\n또, 예외 객체를 새로 생성하고 초기화 하는 과정이 반복되기 때문에 좋지 않다. 그리고 Exception이 발생하면 그것이 어떤 예외인지 적절한 예외 핸들러를 찾아 리턴해줘야 하는데, 예외 핸들러를 찾는 과정 또한 오래 걸린다.\n\n프로젝트를 할 때도, 적절한 예외 상황에 Custom Exception을 던지곤 했는데, 이게 맞는 방법인지 생각해볼 필요가 있는 듯 하다.\n\n그리고 스택 추적이 필요하지 않은 경우라면 override를 통해 trace를 담지 않도록 하는 방법도 좋겠다."
        }
      ],
      "blogListPaginated": [
        {
          "items": [
            "/2024/02/13/2023-retrospect",
            "/2024/02/04/troubleshooting-express-no-response",
            "/2024/01/29/first-opensearch-contribute-docker-compose",
            "/2024/01/02/java-no-stacktrace"
          ],
          "metadata": {
            "permalink": "/blog",
            "page": 1,
            "postsPerPage": 10,
            "totalPages": 1,
            "totalCount": 4,
            "blogDescription": "Blog",
            "blogTitle": "Blog"
          }
        }
      ],
      "blogTags": {
        "/blog/tags/retrospect": {
          "label": "retrospect",
          "items": [
            "/2024/02/13/2023-retrospect"
          ],
          "permalink": "/blog/tags/retrospect",
          "pages": [
            {
              "items": [
                "/2024/02/13/2023-retrospect"
              ],
              "metadata": {
                "permalink": "/blog/tags/retrospect",
                "page": 1,
                "postsPerPage": 10,
                "totalPages": 1,
                "totalCount": 1,
                "blogDescription": "Blog",
                "blogTitle": "Blog"
              }
            }
          ],
          "unlisted": false
        },
        "/blog/tags/troubleshooting": {
          "label": "troubleshooting",
          "items": [
            "/2024/02/04/troubleshooting-express-no-response"
          ],
          "permalink": "/blog/tags/troubleshooting",
          "pages": [
            {
              "items": [
                "/2024/02/04/troubleshooting-express-no-response"
              ],
              "metadata": {
                "permalink": "/blog/tags/troubleshooting",
                "page": 1,
                "postsPerPage": 10,
                "totalPages": 1,
                "totalCount": 1,
                "blogDescription": "Blog",
                "blogTitle": "Blog"
              }
            }
          ],
          "unlisted": false
        },
        "/blog/tags/express": {
          "label": "express",
          "items": [
            "/2024/02/04/troubleshooting-express-no-response"
          ],
          "permalink": "/blog/tags/express",
          "pages": [
            {
              "items": [
                "/2024/02/04/troubleshooting-express-no-response"
              ],
              "metadata": {
                "permalink": "/blog/tags/express",
                "page": 1,
                "postsPerPage": 10,
                "totalPages": 1,
                "totalCount": 1,
                "blogDescription": "Blog",
                "blogTitle": "Blog"
              }
            }
          ],
          "unlisted": false
        },
        "/blog/tags/nginx": {
          "label": "nginx",
          "items": [
            "/2024/02/04/troubleshooting-express-no-response"
          ],
          "permalink": "/blog/tags/nginx",
          "pages": [
            {
              "items": [
                "/2024/02/04/troubleshooting-express-no-response"
              ],
              "metadata": {
                "permalink": "/blog/tags/nginx",
                "page": 1,
                "postsPerPage": 10,
                "totalPages": 1,
                "totalCount": 1,
                "blogDescription": "Blog",
                "blogTitle": "Blog"
              }
            }
          ],
          "unlisted": false
        },
        "/blog/tags/docker": {
          "label": "docker",
          "items": [
            "/2024/01/29/first-opensearch-contribute-docker-compose"
          ],
          "permalink": "/blog/tags/docker",
          "pages": [
            {
              "items": [
                "/2024/01/29/first-opensearch-contribute-docker-compose"
              ],
              "metadata": {
                "permalink": "/blog/tags/docker",
                "page": 1,
                "postsPerPage": 10,
                "totalPages": 1,
                "totalCount": 1,
                "blogDescription": "Blog",
                "blogTitle": "Blog"
              }
            }
          ],
          "unlisted": false
        },
        "/blog/tags/opensource-contributions": {
          "label": "opensource-contributions",
          "items": [
            "/2024/01/29/first-opensearch-contribute-docker-compose"
          ],
          "permalink": "/blog/tags/opensource-contributions",
          "pages": [
            {
              "items": [
                "/2024/01/29/first-opensearch-contribute-docker-compose"
              ],
              "metadata": {
                "permalink": "/blog/tags/opensource-contributions",
                "page": 1,
                "postsPerPage": 10,
                "totalPages": 1,
                "totalCount": 1,
                "blogDescription": "Blog",
                "blogTitle": "Blog"
              }
            }
          ],
          "unlisted": false
        },
        "/blog/tags/java": {
          "label": "java",
          "items": [
            "/2024/01/02/java-no-stacktrace"
          ],
          "permalink": "/blog/tags/java",
          "pages": [
            {
              "items": [
                "/2024/01/02/java-no-stacktrace"
              ],
              "metadata": {
                "permalink": "/blog/tags/java",
                "page": 1,
                "postsPerPage": 10,
                "totalPages": 1,
                "totalCount": 1,
                "blogDescription": "Blog",
                "blogTitle": "Blog"
              }
            }
          ],
          "unlisted": false
        }
      },
      "blogTagsListPath": "/blog/tags"
    }
  },
  "docusaurus-plugin-content-pages": {
    "default": [
      {
        "type": "jsx",
        "permalink": "/",
        "source": "@site/src/pages/index.js"
      },
      {
        "type": "mdx",
        "permalink": "/markdown-page",
        "source": "@site/src/pages/markdown-page.md",
        "title": "Markdown page example",
        "description": "You don't need React to write simple standalone pages.",
        "frontMatter": {
          "title": "Markdown page example"
        },
        "unlisted": false
      }
    ]
  },
  "docusaurus-plugin-debug": {},
  "docusaurus-plugin-google-gtag": {},
  "docusaurus-theme-classic": {},
  "docusaurus-bootstrap-plugin": {},
  "docusaurus-mdx-fallback-plugin": {}
}